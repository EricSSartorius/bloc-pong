// Generated by CoffeeScript 1.7.1
(function() {
  var Ball, Computer, Paddle, Player, animate, ball, canvas, computer, context, height, move, paddle1, player, render, step, width;

  canvas = document.getElementById("canvas");

  width = 640;

  height = 480;

  canvas.width = width;

  canvas.height = height;

  context = canvas.getContext("2d");

  Paddle = function(x, y, width, height) {
    this.x = x;
    this.y = y;
    this.width = width;
    this.height = height;
    return this.y_speed = 0;
  };

  Paddle.prototype.render = function() {
    context.fillStyle = 'white';
    return context.fillRect(this.x, this.y, this.width, this.height);
  };

  Paddle.prototype.goUp = function() {
    this.y_speed -= 1;
    if (this.y_speed < -5) {
      return this.y_speed = -5;
    }
  };

  Paddle.prototype.goDown = function() {
    this.y_speed += 1;
    if (this.y_speed > 5) {
      return this.y_speed = 5;
    }
  };

  Paddle.prototype.move = function() {
    this.y += this.y_speed;
    if (this.y < 0) {
      this.y = 0;
      return this.y_speed = 0;
    } else if (this.y > canvas.height - this.height) {
      this.y = canvas.height - this.height;
      return this.y_speed = 0;
    }
  };

  Player = function() {
    return this.paddle1 = new Paddle(10, canvas.height / 2 - 50, 10, 100);
  };

  Computer = function() {
    return this.paddle2 = new Paddle(620, canvas.height / 2 - 50, 10, 100);
  };

  Player.prototype.render = function() {
    return this.paddle1.render();
  };

  Computer.prototype.render = function() {
    return this.paddle2.render();
  };

  Ball = function(x, y) {
    this.x = x;
    this.y = y;
    this.radius = 7;
    this.x_speed = -3;
    return this.y_speed = Math.floor(Math.random() * 7) + -3;
  };

  Ball.prototype.move = function() {
    var bottom_wall, left_wall, right_wall, top_wall;
    this.x += this.x_speed;
    this.y += this.y_speed;
    left_wall = this.x - this.radius;
    right_wall = this.x + this.radius;
    top_wall = this.y - this.radius;
    bottom_wall = this.y + this.radius;
    if (top_wall < 0) {
      console.log("top wall");
      this.y = this.radius;
      this.y_speed = -this.y_speed;
    } else if (bottom_wall > canvas.height) {
      console.log("bottom wall");
      this.y = canvas.height - this.radius;
      this.y_speed = -this.y_speed;
    } else if (left_wall < 0) {
      console.log("left wall: " + paddle1.x);
      this.x = this.radius;
      this.x_speed = -this.x_speed;
    } else if (right_wall > canvas.width) {
      console.log("right wall");
      this.x = canvas.width - this.radius;
      this.x_speed = -this.x_speed;
    }
    if (ball.x < (paddle1.x + paddle1.width) && (ball.x + ball.width) > paddle1.x && (ball.y + ball.height) > paddle1.y && ball.y < (paddle1.y + paddle1.height)) {
      console.log("player paddle hit");
      this.x_speed = -3;
      this.y_speed += paddle1.y_speed / 2;
      return this.x_speed = -this.x_speed;
    }
  };

  Ball.prototype.render = function() {
    context.beginPath();
    context.arc(this.x, this.y, this.radius, 2 * Math.PI, false);
    context.fillStyle = 'white';
    return context.fill();
  };

  paddle1 = new Paddle(10, canvas.height / 2 - 50, 10, 100);

  player = new Player;

  computer = new Computer;

  ball = new Ball(canvas.width / 2, canvas.height / 2);

  render = function() {
    context.fillStyle = "#000";
    context.fillRect(0, 0, width, height);
    context.beginPath();
    context.moveTo(320, 0);
    context.lineTo(320, 480);
    context.lineWidth = 2;
    context.strokeStyle = "#fff";
    context.stroke();
    player.render();
    computer.render();
    return ball.render();
  };

  animate = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(callback) {
    return window.setTimeout(callback, 1000 / 60);
  };

  move = function() {
    player.move();
    computer.move();
    return ball.move();
  };

  step = function() {
    move();
    render();
    return animate(step);
  };

  window.addEventListener('keydown', function(event) {
    if (event.keyCode === 38) {
      return player.goUp();
    } else if (event.keyCode === 40) {
      return player.goDown();
    }
  });

  window.onload = function() {
    return animate(step);
  };

}).call(this);
